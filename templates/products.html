<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Məhsullar - ElectroLink.az</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#FF6B35',
            secondary: '#0066FF',
            navyDark: '#0A1628',
            navyBox: '#1A2942',
          }
        }
      }
    }
  </script>

  <style>
   /* ===== Global Font ===== */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
* { font-family: 'Inter', sans-serif; }

/* ===== Smooth Transitions ===== */
body {
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* ===== Product Cards (match homepage) ===== */
.product-card {
  transition: all 0.3s ease;
  border-radius: 1rem;
}
.product-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
}

/* ===== Images ===== */
.product-card img {
  transition: transform 0.4s ease;
}
.product-card:hover img {
  transform: scale(1.05);
}

/* ===== Cart Badge ===== */
.cart-badge {
  position: absolute;
  top: -8px;
  right: -8px;
  background: #FF6B35;
  color: white;
  border-radius: 9999px;
  width: 22px;
  height: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}

/* ===== Notification (same as homepage) ===== */
.notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #10B981;
  color: white;
  padding: 14px 28px;
  border-radius: 10px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  z-index: 9999;
  animation: slideUp 0.3s ease-out;
  font-size: 15px;
}
@keyframes slideUp {
  from {
    transform: translateX(-50%) translateY(80px);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
}

 footer {
    background: linear-gradient(135deg, #0A1628, #0066FF);
    color: #ffffff;
  }

  footer a:hover {
    color: #FF6B35;
  }

/* ===== Line Clamp ===== */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ===== WhatsApp Floating Button ===== */
.whatsapp-float {
  position: fixed;
  bottom: 25px;
  right: 25px;
  z-index: 1000;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.06); }
}

/* ===== Filters Container ===== */
select {
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
select:focus {
  border-color: #0066FF;
  box-shadow: 0 0 0 3px rgba(0,102,255,0.15);
  outline: none;
}

/* ===== Search Input ===== */
input[type="text"] {
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
input[type="text"]:focus {
  border-color: #0066FF;
  box-shadow: 0 0 0 4px rgba(0,102,255,0.15);
  outline: none;
}

/* ===== Buttons ===== */
button {
  transition: all 0.25s ease;
}
button:hover {
  transform: translateY(-1px);
}

/* ===== Dark Mode Tweaks ===== */
.dark .product-card {
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}
.dark .product-card:hover {
  box-shadow: 0 25px 45px rgba(0, 0, 0, 0.6);
}

/* first button = Səbətə */
.product-card button:first-of-type {
  background: linear-gradient(135deg, #0066FF, #3385ff);
  color: white;
}

/* second button = Sifariş edin */
.product-card button:last-of-type {
  background: linear-gradient(135deg, #FF6B35, #ff855a);
  color: white;
}

  .product-card .price,
.product-card .product-price,
.product-card span[class*="price"],
.product-card p[class*="price"] {
  color: #FF6B35 !important;
}

/* ===== Modal Scroll ===== */
.modal-content {
  max-height: 90vh;
  overflow-y: auto;
}

/* LOGO */
#logoImage {
  height: 42px;
  max-height: 42px;
  width: auto;
  object-fit: contain;
}

@media (min-width: 768px) {
  #logoImage {
    height: 48px;
    max-height: 48px;
  }
}

  </style>
</head>
<body class="bg-white dark:bg-navyDark text-gray-900 dark:text-gray-100 transition-colors">

<!-- Navbar -->
<nav class="bg-white dark:bg-navyBox shadow-md sticky top-0 z-50 transition-colors">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      <div class="flex items-center">
        <a href="/"><img id="logoImage" src="/static/images/Electrolink transparent.png" alt="ElectroLink" class="w-auto"></a>
      </div>
        <div class="hidden md:flex space-x-8 text-base ml-auto mr-16">
        <a href="/products" class="text-gray-700 dark:text-gray-300 hover:text-primary font-medium transition">Məhsullar</a>
        <a href="/about" class="text-gray-700 dark:text-gray-300 hover:text-primary font-medium transition">Haqqımızda</a>
        <a href="/contact" class="text-gray-700 dark:text-gray-300 hover:text-primary font-medium transition">Əlaqə</a>
      </div>
      <div class="flex items-center space-x-4">
        <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          <i id="themeIcon" class="fas fa-moon text-2xl text-gray-700 dark:text-gray-300"></i>
        </button>
        <a href="/cart" class="relative">
          <i class="fas fa-shopping-cart text-3xl text-gray-700 dark:text-gray-300 hover:text-primary transition"></i>
          <span id="cartCount" class="cart-badge">0</span>
        </a>
        <button id="mobileMenuBtn" class="md:hidden text-gray-700 dark:text-gray-300"><i class="fas fa-bars text-2xl"></i></button>
      </div>
    </div>
  </div>
  <div id="mobileMenu" class="hidden md:hidden border-t bg-white dark:bg-navyBox border-gray-200 dark:border-gray-700">
    <div class="px-4 py-4 space-y-3">
      <a href="/products" class="block text-primary font-semibold text-lg py-2">Məhsullar</a>
      <a href="/about" class="block text-gray-700 dark:text-gray-300 hover:text-primary font-medium text-lg py-2">Haqqımızda</a>
      <a href="/contact" class="block text-gray-700 dark:text-gray-300 hover:text-primary font-medium text-lg py-2">Əlaqə</a>
    </div>
  </div>
</nav>

<!-- Page Header -->
<section class="py-12 px-4 bg-gradient-to-br from-blue-50 to-white dark:from-navyDark dark:to-navyBox transition-colors">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 text-gray-900 dark:text-white">Məhsullar</h1>
    <div class="max-w-2xl mx-auto mb-8">
      <div class="relative">
        <input type="text" id="searchInput" placeholder="Məhsul axtar (ad və ya kod)..." class="w-full px-6 py-4 pr-12 text-lg rounded-full border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-navyBox text-gray-900 dark:text-white focus:border-primary focus:outline-none">
        <i class="fas fa-search absolute right-6 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl"></i>
      </div>
    </div>
  </div>
</section>

<!-- Filters & Products -->
<section class="py-8 px-4 bg-white dark:bg-navyDark">
  <div class="max-w-7xl mx-auto">
    <div class="bg-gray-50 dark:bg-navyBox rounded-2xl p-6 mb-8 grid sm:grid-cols-3 gap-4">
      <select id="categoryFilter" class="px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-navyDark text-gray-900 dark:text-white text-lg font-medium">
        <option value="all">Bütün Kateqoriyalar</option>
        <option value="tvbox">TV Box</option>
        <option value="heaters">Qızdırıcılar</option>
        <option value="cameras">Kameralar</option>
        <option value="batteries">Batareyalar</option>
        <option value="accessories">Aksesuarlar</option>
      </select>
      <select id="priceFilter" class="px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-navyDark text-gray-900 dark:text-white text-lg font-medium">
        <option value="all">Bütün Qiymətlər</option>
        <option value="0-100">0 - 100 AZN</option>
        <option value="100-300">100 - 300 AZN</option>
        <option value="300-500">300 - 500 AZN</option>
        <option value="500+">500+ AZN</option>
      </select>
      <select id="sortFilter" class="px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-navyDark text-gray-900 dark:text-white text-lg font-medium">
        <option value="default">Sırala</option>
        <option value="name-asc">Ad (A-Z)</option>
        <option value="name-desc">Ad (Z-A)</option>
        <option value="price-asc">Qiymət (Aşağı)</option>
        <option value="price-desc">Qiymət (Yüksək)</option>
      </select>
    </div>
    <p class="text-gray-600 dark:text-gray-400 mb-6 text-lg">
      Göstərilir: <span id="productCount" class="text-primary font-bold">0</span> məhsul
    </p>
    <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
    <div id="noResults" class="hidden text-center py-16">
      <i class="fas fa-search text-6xl text-gray-400 mb-4"></i>
      <h3 class="text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-2">Heç bir məhsul tapılmadı</h3>
      <p class="text-gray-500">Axtarışı dəyişdirin və ya filterləri sıfırlayın</p>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-gray-900 text-white py-12 px-4">
  <div class="max-w-7xl mx-auto grid md:grid-cols-4 gap-8">
    <div>
      <h3 class="text-xl font-bold mb-4">Əlaqə</h3>
      <p class="mb-2"><i class="fas fa-phone mr-2"></i> +994 10 505 16 15</p>
      <p><i class="fas fa-map-marker-alt mr-2"></i> Bakı, Azərbaycan</p>
    </div>
    <div>
      <h3 class="text-xl font-bold mb-4">İş Saatları</h3>
      <p>B.e - Cümə: 09:00 - 18:00</p>
      <p>Şənbə: 10:00 - 16:00</p>
      <p>Bazar: Bağlı</p>
    </div>
    <div>
      <h3 class="text-xl font-bold mb-4">Səhifələr</h3>
      <ul class="space-y-2">
        <li><a href="/warranty" class="hover:text-primary">Terms and Conditions</a></li>
        <li><a href="/faq" class="hover:text-primary">Tez-tez Verilən Suallar</a></li>
      </ul>
    </div>
    <div>
      <h3 class="text-xl font-bold mb-4">Sosial Şəbəkələr</h3>
      <div class="flex space-x-4 text-3xl">
        <a href="https://www.instagram.com/electrolink.az/" target="_blank" class="hover:text-primary"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@electrolink.az" target="_blank" class="hover:text-primary"><i class="fab fa-tiktok"></i></a>
        <a href="https://wa.me/994105051615" target="_blank" class="hover:text-primary"><i class="fab fa-whatsapp"></i></a>
      </div>
    </div>
  </div>
  <div class="border-t border-gray-700 mt-8 pt-8 text-center">
    <p>© 2025 ElectroLink.az - Bütün hüquqlar qorunur</p>
    <p class="text-sm text-gray-400 mt-2">VÖEN: 1234567890</p>
  </div>
</footer>

<!-- WhatsApp Float -->
<a href="https://wa.me/994105051615" target="_blank" class="whatsapp-float">
  <div class="bg-green-500 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-2xl hover:bg-green-600 transition">
    <i class="fab fa-whatsapp text-4xl"></i>
  </div>
</a>

<!-- Notification -->
<div id="notification" class="notification hidden">
  <div class="flex items-center">
    <i class="fas fa-check-circle text-2xl mr-3"></i>
    <span class="text-lg font-semibold">Səbətə əlavə edildi ✅</span>
  </div>
</div>

<!-- PRODUCT DETAIL MODAL - RESPONSIVE -->
<div id="productModal" class="fixed inset-0 z-[9999] hidden bg-black/60 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-navyBox w-full max-w-5xl rounded-3xl shadow-2xl relative overflow-y-auto" style="max-height: 90vh;">
    
    <!-- Close Button -->
    <button onclick="closeProductModal()" class="absolute top-4 right-4 z-10 text-3xl text-gray-400 hover:text-primary bg-white dark:bg-navyDark rounded-full w-10 h-10 flex items-center justify-center">
      &times;
    </button>

    <!-- RESPONSIVE LAYOUT -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 p-4 md:p-6">

      <!-- LEFT: Images Section -->
      <div>
        <!-- Main Image - FIXED: Changed object-cover to object-contain -->
        <div class="bg-gray-100 dark:bg-navyDark rounded-xl mb-4 flex items-center justify-center" style="min-height: 250px; height: 300px;">
          <img id="modalMainImage" class="w-full h-full object-contain rounded-xl p-4" alt="Product">
        </div>
        
        <!-- Thumbnails -->
        <div id="modalThumbnails" class="flex gap-2 flex-wrap justify-center lg:justify-start"></div>
      </div>

      <!-- RIGHT: Product Info Section -->
      <div class="flex flex-col">
        <h2 id="modalName" class="text-2xl md:text-3xl font-bold mb-2 text-gray-900 dark:text-white"></h2>
        <p id="modalCode" class="text-sm text-gray-500 dark:text-gray-400 mb-2"></p>
        <p id="modalPrice" class="text-3xl md:text-4xl font-bold text-primary mb-2"></p>
        <p id="modalStock" class="text-green-600 text-sm font-semibold mb-3">
          <i class="fas fa-check-circle mr-1"></i>Stokda mövcuddur
        </p>

        <p id="modalDescription" class="text-gray-700 dark:text-gray-300 mb-4 leading-relaxed text-sm md:text-base"></p>

        <ul id="modalHighlights" class="space-y-2 mb-4 md:mb-6 text-gray-700 dark:text-gray-300 text-sm md:text-base"></ul>

        <!-- Quantity Selector -->
        <div class="flex items-center gap-3 mb-4 md:mb-6">
          <span class="text-gray-700 dark:text-gray-300 font-medium text-sm md:text-base">Miqdar:</span>
          <button onclick="changeModalQty(-1)" class="px-3 md:px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
            <i class="fas fa-minus text-sm"></i>
          </button>
          <input id="modalQty" type="number" value="1" min="1" class="w-16 md:w-20 text-center text-base md:text-lg border-2 rounded-lg py-2 dark:bg-navyDark dark:border-gray-600 dark:text-white">
          <button onclick="changeModalQty(1)" class="px-3 md:px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
            <i class="fas fa-plus text-sm"></i>
          </button>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-2 md:gap-3 mt-auto">
          <button id="modalOrderBtn" class="flex-1 bg-gradient-to-r from-primary to-orange-600 text-white px-4 md:px-6 py-3 md:py-4 rounded-xl font-bold text-base md:text-lg hover:shadow-lg transition">
            <i class="fab fa-whatsapp mr-2"></i>Sifariş Et
          </button>
          <button id="modalCartBtn" class="flex-1 bg-gradient-to-r from-secondary to-blue-600 text-white px-4 md:px-6 py-3 md:py-4 rounded-xl font-bold text-base md:text-lg hover:shadow-lg transition">
            <i class="fas fa-shopping-cart mr-2"></i>Səbətə At
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
// ======== Hardcoded products (no API needed) ========
const products = [
  { 
    id: 1, 
    name: "TV Box 4K Ultra HD", 
    code: "EL-TVB01", 
    category: "tvbox", 
    price: 149.99, 
    image: "/static/images/xiaotv0.png",
    images: ['/static/images/xiaotv0.png', '/static/images/xiaotv1.png', '/static/images/xiaotv2.png'],
    description: '4K Ultra HD TV Box – sürətli və rahat istifadə.',
    highlights: ['4K Ultra HD görüntü', 'Sürətli və stabil işləmə', 'YouTube, Netflix və tətbiqlər']
  },
  { 
    id: 2, 
    name: "Portativ Qızdırıcı", 
    code: "EL-QZD01", 
    category: "heaters", 
    price: 49.99, 
    image: '/static/images/RAF qizdirici main.png',
    images: ['/static/images/raf fan guc.png', '/static/images/raf fan dayan.png', '/static/images/raf fan.png'],
    description: 'Güclü 2000W portativ sürətli qızdırıcı.',
    highlights: ['2000W güclü isitmə', 'Avtomatik temperatur', 'Enerji qənaətcil']
  },
  { 
    id: 3, 
    name: "Mini simsiz klaviatura + touchpad", 
    code: "EL-KB01", 
    category: "accessories", 
    price: 13.99, 
    image: '/static/images/kb0.png',
    images: ['/static/images/kb0.png', '/static/images/kb1.png'],
    description: 'Kompakt simsiz klaviatura touchpad ilə.',
    highlights: ['Bluetooth 5.0', 'Touchpad', 'Portativ']
  }
];

let filteredProducts = [...products]; // Start with all products

// CLEAN CART SYSTEM - Same as index.html (NO MIGRATION LOGIC)
function getCart() {
  const cartData = localStorage.getItem('cart');
  if (!cartData) return [];
  
  try {
    const cart = JSON.parse(cartData);
    // Ensure all items have qty property
    return cart.map(item => ({
      ...item,
      qty: item.qty || 1
    }));
  } catch (e) {
    console.error('Cart parsing error:', e);
    return [];
  }
}

function saveCart(cart) {
  localStorage.setItem('cart', JSON.stringify(cart));
}

function updateCartCount() {
  const cart = getCart();
  const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
  document.getElementById('cartCount').textContent = totalQty;
}

function addToCart(product, qty = 1) {
  const cart = getCart();
  const existing = cart.find(p => p.id === product.id);
  
  if (existing) {
    existing.qty += qty;
  } else {
    cart.push({
      id: product.id,
      name: product.name,
      code: product.code,
      price: product.price,
      image: product.image,
      qty: qty
    });
  }
  
  saveCart(cart);
  updateCartCount();
  showNotification();
}

function showNotification() {
  const notification = document.getElementById('notification');
  notification.classList.remove('hidden');
  setTimeout(() => notification.classList.add('hidden'), 3000);
}

function orderNow(productName, productCode, price) {
  const message = `Salam! Aşağıdakı məhsulu sifariş etmək istəyirəm:\n\n${productName}\nKod: ${productCode}\nQiymət: ${price} AZN\nMiqdar: 1`;
  const whatsappUrl = `https://wa.me/994105051615?text=${encodeURIComponent(message)}`;
  window.open(whatsappUrl, '_blank');
}

function renderProducts() {
  const grid = document.getElementById('productsGrid');
  const noResults = document.getElementById('noResults');
  const countEl = document.getElementById('productCount');
  countEl.textContent = filteredProducts.length;
  
  if (!filteredProducts.length) {
    grid.innerHTML = '';
    noResults.classList.remove('hidden');
    return;
  }
  
  noResults.classList.add('hidden');
  
  // Use data attributes instead of onclick with JSON
  grid.innerHTML = filteredProducts.map(p => `
    <div class="product-card bg-white dark:bg-navyBox rounded-2xl shadow-lg overflow-hidden" data-product-id="${p.id}">
      <div class="cursor-pointer product-card-clickable">
        <div class="aspect-square bg-gray-100 dark:bg-navyDark">
          <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover">
        </div>
        <div class="p-4">
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Kod: ${p.code}</p>
          <h3 class="text-lg font-bold mb-2 line-clamp-2 text-gray-900 dark:text-white">${p.name}</h3>
          <p class="text-2xl font-bold text-primary mb-4">${p.price} AZN</p>
        </div>
      </div>
      <div class="px-4 pb-4">
        <div class="grid grid-cols-2 gap-2">
          <button class="order-btn bg-primary text-white px-3 py-2 rounded-lg font-semibold hover:bg-orange-700 transition text-sm">
            Sifariş Et
          </button>
          <button class="cart-btn bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition text-sm">
            Səbətə
          </button>
        </div>
      </div>
    </div>
  `).join('');

  // Add event listeners after rendering
  attachProductEventListeners();
}

function attachProductEventListeners() {
  const productCards = document.querySelectorAll('.product-card');
  
  productCards.forEach(card => {
    const productId = parseInt(card.dataset.productId);
    const product = filteredProducts.find(p => p.id === productId);
    
    if (!product) return;
    
    // Click on card image/info to open modal
    const clickableArea = card.querySelector('.product-card-clickable');
    if (clickableArea) {
      clickableArea.addEventListener('click', () => openProductModal(product));
    }
    
    // Order button
    const orderBtn = card.querySelector('.order-btn');
    if (orderBtn) {
      orderBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        orderNow(product.name, product.code, product.price);
      });
    }
    
    // Cart button
    const cartBtn = card.querySelector('.cart-btn');
    if (cartBtn) {
      cartBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        addToCart(product);
      });
    }
  });
}

const categoryFilter = document.getElementById('categoryFilter');
const priceFilter = document.getElementById('priceFilter');
const sortFilter = document.getElementById('sortFilter');
const searchInput = document.getElementById('searchInput');

function applyFilters() {
  const cat = categoryFilter.value;
  const priceRange = priceFilter.value;
  const sort = sortFilter.value;
  const searchQuery = searchInput.value.toLowerCase();
  
  filteredProducts = products.filter(product => {
    const catMatch = cat === 'all' || product.category === cat;
    const searchMatch = searchQuery === '' || 
      product.name.toLowerCase().includes(searchQuery) ||
      product.code.toLowerCase().includes(searchQuery);

    let priceMatch = true;
    if (priceRange !== 'all') {
      if (priceRange === '0-100') priceMatch = product.price <= 100;
      else if (priceRange === '100-300') priceMatch = product.price > 100 && product.price <= 300;
      else if (priceRange === '300-500') priceMatch = product.price > 300 && product.price <= 500;
      else if (priceRange === '500+') priceMatch = product.price > 500;
    }

    return catMatch && priceMatch && searchMatch;
  });

  // Sorting
  if (sort === 'name-asc') filteredProducts.sort((a,b) => a.name.localeCompare(b.name));
  else if (sort === 'name-desc') filteredProducts.sort((a,b) => b.name.localeCompare(a.name));
  else if (sort === 'price-asc') filteredProducts.sort((a,b) => a.price - b.price);
  else if (sort === 'price-desc') filteredProducts.sort((a,b) => b.price - a.price);

  renderProducts();
}

categoryFilter.addEventListener('change', applyFilters);
priceFilter.addEventListener('change', applyFilters);
sortFilter.addEventListener('change', applyFilters);
searchInput.addEventListener('input', applyFilters);

// Theme toggle
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const logoImage = document.getElementById('logoImage');
const root = document.documentElement;

function applyTheme(theme) {
  if (theme === 'dark') {
    root.classList.add('dark');
    themeIcon.className = 'fas fa-sun text-2xl text-yellow-400';
    logoImage.src = '/static/images/darkmodenew.png';
  } else {
    root.classList.remove('dark');
    themeIcon.className = 'fas fa-moon text-2xl text-gray-700';
    logoImage.src = '/static/images/Electrolink transparent.png';
  }
  localStorage.setItem('theme', theme);
}

const savedTheme = localStorage.getItem('theme') || 'light';
applyTheme(savedTheme);

themeToggle.addEventListener('click', () => {
  const next = root.classList.contains('dark') ? 'light' : 'dark';
  applyTheme(next);
});

// Mobile menu toggle
document.getElementById('mobileMenuBtn').addEventListener('click', () => {
  document.getElementById('mobileMenu').classList.toggle('hidden');
});

// Modal Functions
let modalProduct = null;

function openProductModal(product) {
  modalProduct = product;
  document.getElementById('productModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';

  // Set main image
  const images = product.images || [product.image];
  document.getElementById('modalMainImage').src = images[0];
  
  // Set product info
  document.getElementById('modalName').textContent = product.name;
  document.getElementById('modalCode').textContent = 'Kod: ' + product.code;
  document.getElementById('modalPrice').textContent = product.price + ' AZN';
  document.getElementById('modalDescription').textContent = product.description || 'Yüksək keyfiyyətli məhsul';
  document.getElementById('modalQty').value = 1;

  // Thumbnails
  const thumbs = document.getElementById('modalThumbnails');
  thumbs.innerHTML = '';
  images.forEach((img) => {
    const t = document.createElement('img');
    t.src = img;
    t.className = 'w-16 h-16 object-cover rounded-lg cursor-pointer border-2 border-transparent hover:border-primary transition';
    t.onclick = () => document.getElementById('modalMainImage').src = img;
    thumbs.appendChild(t);
  });

  // Highlights
  const highlights = product.highlights || ['Keyfiyyətli', 'Zəmanətli', 'Orijinal'];
  const list = document.getElementById('modalHighlights');
  list.innerHTML = '';
  highlights.forEach(h => {
    list.innerHTML += `
      <li class="flex items-center gap-2">
        <i class="fas fa-check-circle text-primary"></i>
        <span>${h}</span>
      </li>`;
  });

  // Order button action
  document.getElementById('modalOrderBtn').onclick = () => {
    const qty = document.getElementById('modalQty').value;
    const msg = `Salam! Aşağıdakı məhsulu sifariş etmək istəyirəm:\n\n${product.name}\nKod: ${product.code}\nQiymət: ${product.price} AZN\nMiqdar: ${qty}`;
    window.open('https://wa.me/994105051615?text=' + encodeURIComponent(msg), '_blank');
  };

  // Cart button action
  document.getElementById('modalCartBtn').onclick = () => {
    const qty = parseInt(document.getElementById('modalQty').value);
    addToCart(product, qty);
    closeProductModal();
  };
}

function closeProductModal() {
  document.getElementById('productModal').classList.add('hidden');
  document.body.style.overflow = '';
}

function changeModalQty(delta) {
  const qtyInput = document.getElementById('modalQty');
  const newValue = Math.max(1, parseInt(qtyInput.value) + delta);
  qtyInput.value = newValue;
}

// Initialize
updateCartCount();
applyFilters(); // Render products on load
</script>

</body>
</html>