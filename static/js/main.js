// Translations
const translations = {
    az: {
        nav_products: "M…ôhsullar",
        nav_about: "Haqqƒ±mƒ±zda",
        nav_contact: "∆èlaq…ô",
        nav_warranty: "Z…ôman…ôt",
        nav_faq: "FAQ",
        hero_title: "Premium Texnologiya M…ôhsullarƒ±",
        hero_subtitle: "TV Box, Qƒ±zdƒ±rƒ±cƒ±lar v…ô daha √ßox m…ôhsullar",
        hero_cta: "B√ºt√ºn √áe≈üidl…ôr",
        section_categories: "Kateqoriyalar",
        section_featured: "Se√ßilmi≈ü M…ôhsullar",
        section_services: "Xidm…ôtl…ôrimiz",
        section_how: "Nec…ô sifari≈ü edim?",
        cat_heaters: "Portativ Qƒ±zdƒ±rƒ±cƒ±lar",
        cat_accessories: "Aksesuarlar",
        cat_all: "Hamƒ±sƒ±",
        service_tv: "TV Box Kanal Y√ºkl…ônm…ôsi",
        service_tv_desc: "Kanal …ôlav…ô etm…ô v…ô sazlama",
        service_camera: "Kamera Sisteml…ôri",
        service_camera_desc: "Qura≈üdƒ±rma v…ô konfiqurasiya",
        service_battery: "Batareya Hazƒ±rlƒ±ƒüƒ±",
        service_battery_desc: "Batareya yƒ±ƒüƒ±lmasƒ±",
        service_support: "Texniki D…ôst…ôk",
        service_support_desc: "Pe≈ü…ôkar yardƒ±m",
        step1_title: "M…ôhsulu b…ôy…ônin",
        step1_desc: "Kataloqdan se√ßin",
        step2_title: "Sifari≈ü et click edin",
        step2_desc: "WhatsApp-a ke√ßid",
        step3_title: "Sifari≈üiniz bizd…ôdir üòÅ",
        step3_desc: "Tezlikl…ô √ßatdƒ±rƒ±rƒ±q",
        btn_order: "Sifari≈ü et",
        btn_cart: "S…ôb…ôt…ô",
        page_products: "M…ôhsullar",
        page_cart: "S…ôb…ôt",
        page_about: "Haqqƒ±mƒ±zda",
        page_contact: "∆èlaq…ô",
        page_warranty: "Z…ôman…ôt v…ô Qaytarma",
        page_faq: "Tez-tez veril…ôn suallar",
        search_placeholder: "M…ôhsul axtar...",
        filter_all: "Hamƒ±sƒ±",
        back_products: "M…ôhsullara qayƒ±t",
        quantity_label: "Miqdar:",
        desc_title: "T…ôsvir",
        specs_title: "X√ºsusiyy…ôtl…ôr",
        warranty_info: "Z…ôman…ôt v…ô √ßatdƒ±rƒ±lma ≈ü…ôrtl…ôri",
        warranty_link: "…ôtraflƒ±",
        cart_empty: "S…ôb…ôtiniz bo≈üdur",
        continue_shopping: "M…ôhsullara bax",
        cart_total: "C…ôm:",
        send_order: "Sifari≈ü et",
        contact_phone: "Telefon",
        contact_email: "Email",
        contact_address: "√únvan",
        footer_desc: "Premium texnologiya m…ôhsullarƒ±",
        footer_contact: "∆èlaq…ô",
        footer_links: "Ke√ßidl…ôr",
        footer_social: "Sosial Media",
        footer_rights: "B√ºt√ºn h√ºquqlar qorunur",
        warranty_title: "Z…ôman…ôt ≈û…ôrtl…ôri",
        return_title: "Qaytarma Qaydalarƒ±",
        delivery_title: "√áatdƒ±rƒ±lma",
        faq_q1: "Online √∂d…ôni≈ü m√ºmk√ºnd√ºrm√º?",
        faq_a1: "Xeyr, saytda online √∂d…ôni≈ü yoxdur. Sifari≈ü yalnƒ±z WhatsApp vasit…ôsil…ô h…ôyata ke√ßirilir.",
        faq_q2: "Nec…ô sifari≈ü ed…ô bil…ôr…ôm?",
        faq_a2: "M…ôhsulu se√ßin v…ô 'Sifari≈ü et' d√ºym…ôsin…ô basƒ±n. Avtomatik olaraq WhatsApp-a y√∂nl…ôndiril…ôc…ôksiniz.",
        faq_q3: "√áatdƒ±rƒ±lma n…ô q…ôd…ôr √ß…ôkir?",
        faq_a3: "Bakƒ± daxilind…ô 1-2 g√ºn, regionlara 2-3 g√ºn …ôrzind…ô √ßatdƒ±rƒ±lma h…ôyata ke√ßirilir.",
        faq_q4: "Z…ôman…ôt varmƒ±?",
        faq_a4: "B…ôli, b√ºt√ºn m…ôhsullara z…ôman…ôt verilir. Z…ôman…ôt m√ºdd…ôti m…ôhsuldan asƒ±lƒ± olaraq d…ôyi≈üir."
    },
    tr: {
        nav_products: "√úr√ºnler",
        nav_about: "Hakkƒ±mƒ±zda",
        nav_contact: "ƒ∞leti≈üim",
        nav_warranty: "Garanti",
        nav_faq: "SSS",
        hero_title: "Premium Teknoloji √úr√ºnler",
        hero_subtitle: "TV Box, Isƒ±tƒ±cƒ±lar ve daha fazlasƒ±",
        hero_cta: "T√ºm √úr√ºnler",
        section_categories: "Kategoriler",
        section_featured: "√ñne √áƒ±kan √úr√ºnler",
        section_services: "Hizmetlerimiz",
        section_how: "Nasƒ±l sipari≈ü veririm?",
        cat_heaters: "Portatif Isƒ±tƒ±cƒ±lar",
        cat_accessories: "Aksesuarlar",
        cat_all: "T√ºm√º",
        service_tv: "TV Box Kanal Y√ºklemesi",
        service_tv_desc: "Kanal ekleme ve ayarlama",
        service_camera: "Kamera Sistemleri",
        service_camera_desc: "Kurulum ve yapƒ±landƒ±rma",
        service_battery: "Batarya Hazƒ±rlƒ±ƒüƒ±",
        service_battery_desc: "Batarya montajƒ±",
        service_support: "Teknik Destek",
        service_support_desc: "Profesyonel yardƒ±m",
        step1_title: "√úr√ºn√º beƒüenin",
        step1_desc: "Katalogdan se√ßin",
        step2_title: "Sipari≈ü et'e tƒ±klayƒ±n",
        step2_desc: "WhatsApp'a y√∂nlendirme",
        step3_title: "Sipari≈üiniz bizde üòÅ",
        step3_desc: "Hƒ±zlƒ±ca teslim",
        btn_order: "Sipari≈ü et",
        btn_cart: "Sepete",
        page_products: "√úr√ºnler",
        page_cart: "Sepet",
        page_about: "Hakkƒ±mƒ±zda",
        page_contact: "ƒ∞leti≈üim",
        page_warranty: "Garanti ve ƒ∞ade",
        page_faq: "Sƒ±k Sorulan Sorular",
        search_placeholder: "√úr√ºn ara...",
        filter_all: "T√ºm√º",
        back_products: "√úr√ºnlere d√∂n",
        quantity_label: "Miktar:",
        desc_title: "A√ßƒ±klama",
        specs_title: "√ñzellikler",
        warranty_info: "Garanti ve teslimat ko≈üullarƒ±",
        warranty_link: "detaylƒ±",
        cart_empty: "Sepetiniz bo≈ü",
        continue_shopping: "√úr√ºnlere bak",
        cart_total: "Toplam:",
        send_order: "Sipari≈ü et",
        contact_phone: "Telefon",
        contact_email: "Email",
        contact_address: "Adres",
        footer_desc: "Premium teknoloji √ºr√ºnleri",
        footer_contact: "ƒ∞leti≈üim",
        footer_links: "Baƒülantƒ±lar",
        footer_social: "Sosyal Medya",
        footer_rights: "T√ºm haklarƒ± saklƒ±dƒ±r"
    },
    ru: {
        nav_products: "–ü—Ä–æ–¥—É–∫—Ç—ã",
        nav_about: "–û –Ω–∞—Å",
        nav_contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        nav_warranty: "–ì–∞—Ä–∞–Ω—Ç–∏—è",
        nav_faq: "FAQ",
        hero_title: "–ü—Ä–µ–º–∏—É–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
        hero_subtitle: "TV Box, –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª–∏ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ",
        hero_cta: "–í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
        section_categories: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏",
        section_featured: "–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
        section_services: "–ù–∞—à–∏ —É—Å–ª—É–≥–∏",
        section_how: "–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å?",
        cat_heaters: "–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª–∏",
        cat_accessories: "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",
        cat_all: "–í—Å–µ",
        service_tv: "–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ TV Box",
        service_tv_desc: "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–æ–≤",
        service_camera: "–°–∏—Å—Ç–µ–º—ã –∫–∞–º–µ—Ä",
        service_camera_desc: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è",
        service_battery: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞—Ç–∞—Ä–µ–∏",
        service_battery_desc: "–°–±–æ—Ä–∫–∞ –±–∞—Ç–∞—Ä–µ–∏",
        service_support: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
        service_support_desc: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å",
        step1_title: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç",
        step1_desc: "–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞",
        step2_title: "–ù–∞–∂–º–∏—Ç–µ '–ó–∞–∫–∞–∑–∞—Ç—å'",
        step2_desc: "–ü–µ—Ä–µ—Ö–æ–¥ –≤ WhatsApp",
        step3_title: "–í–∞—à –∑–∞–∫–∞–∑ —É –Ω–∞—Å üòÅ",
        step3_desc: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
        btn_order: "–ó–∞–∫–∞–∑–∞—Ç—å",
        btn_cart: "–í –∫–æ—Ä–∑–∏–Ω—É",
        page_products: "–ü—Ä–æ–¥—É–∫—Ç—ã",
        page_cart: "–ö–æ—Ä–∑–∏–Ω–∞",
        page_about: "–û –Ω–∞—Å",
        page_contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        page_warranty: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç",
        page_faq: "–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
        search_placeholder: "–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞...",
        filter_all: "–í—Å–µ",
        back_products: "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ–¥—É–∫—Ç–∞–º",
        quantity_label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:",
        desc_title: "–û–ø–∏—Å–∞–Ω–∏–µ",
        specs_title: "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏",
        warranty_info: "–£—Å–ª–æ–≤–∏—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏",
        warranty_link: "–ø–æ–¥—Ä–æ–±–Ω–µ–µ",
        cart_empty: "–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞",
        continue_shopping: "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã",
        cart_total: "–ò—Ç–æ–≥–æ:",
        send_order: "–ó–∞–∫–∞–∑–∞—Ç—å",
        contact_phone: "–¢–µ–ª–µ—Ñ–æ–Ω",
        contact_email: "Email",
        contact_address: "–ê–¥—Ä–µ—Å",
        footer_desc: "–ü—Ä–µ–º–∏—É–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
        footer_contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        footer_links: "–°—Å—ã–ª–∫–∏",
        footer_social: "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏",
        footer_rights: "–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã"
    }
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    initTheme();
    initLanguage();
    initMobileMenu();
    initLanguageDropdown();
    updateCartBadge();
});

// Theme Toggle
function initTheme() {
    const themeToggle = document.getElementById('themeToggle');
    const currentTheme = localStorage.getItem('theme') || 'light';
    
    if (currentTheme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
    
    themeToggle.addEventListener('click', function() {
        let theme = document.documentElement.getAttribute('data-theme');
        
        if (theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'light');
            localStorage.setItem('theme', 'light');
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        } else {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
    });
}

// Language
function initLanguage() {
    const currentLang = localStorage.getItem('language') || 'az';
    setLanguage(currentLang);
}

function initLanguageDropdown() {
    const langBtn = document.getElementById('langBtn');
    const langDropdown = document.getElementById('langDropdown');
    
    langBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        langDropdown.classList.toggle('active');
    });
    
    document.addEventListener('click', function() {
        langDropdown.classList.remove('active');
    });
    
    langDropdown.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            setLanguage(lang);
            langDropdown.classList.remove('active');
        });
    });
}

function setLanguage(lang) {
    localStorage.setItem('language', lang);
    document.getElementById('currentLang').textContent = lang.toUpperCase();
    
    const t = translations[lang];
    
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) {
            el.textContent = t[key];
        }
    });
    
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (t[key]) {
            el.placeholder = t[key];
        }
    });
}

// Mobile Menu
function initMobileMenu() {
    const menuToggle = document.getElementById('mobileMenuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    
    menuToggle.addEventListener('click', function() {
        mobileMenu.classList.toggle('active');
        const icon = menuToggle.querySelector('i');
        
        if (mobileMenu.classList.contains('active')) {
            icon.className = 'fas fa-times';
        } else {
            icon.className = 'fas fa-bars';
        }
    });
}

// Cart Functions
function updateCartBadge() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartBadge').textContent = totalItems;
}

async function addToCart(productId, quantity = 1) {
    try {
        const response = await fetch(`/api/product/${productId}`);
        const product = await response.json();
        
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        
        const existingItem = cart.find(item => item.id === productId);
        
        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            cart.push({
                id: product.id,
                name: product.name,
                code: product.code,
                price: product.price,
                image: product.image,
                quantity: quantity
            });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartBadge();
        showToast('M…ôhsul s…ôb…ôt…ô …ôlav…ô olundu ‚úÖ');
    } catch (error) {
        console.error('Error adding to cart:', error);
        showToast('X…ôta ba≈ü verdi');
    }
}

function orderNow(code, name, quantity = 1) {
    const message = `Salam! Sizd…ôn ${name} ${code} ${quantity} …ôd…ôd sifari≈ü etm…ôk ist…ôyir…ôm.`;
    const encoded = encodeURIComponent(message);
    window.open(`https://wa.me/994105051615?text=${encoded}`, '_blank');
}

// Toast Notification
function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Make functions globally available
window.addToCart = addToCart;
window.orderNow = orderNow;
window.updateCartBadge = updateCartBadge;
window.showToast = showToast;

document.addEventListener("DOMContentLoaded", async () => {
  const main = document.getElementById("app");

  // Load products section
  const res = await fetch("/api/products");
  const products = await res.json();

  main.innerHTML = `
    <section id="products">
      <h2>M…ôhsullar</h2>
      <div class="products-grid">
        ${products.map(p => `
          <div class="product-card">
            <a href="/product/${p.id}">
              <img src="/static/images/${p.images[0]}" alt="${p.name.az}">
              <h3>${p.name.az}</h3>
              <p>${p.price}</p>
            </a>
          </div>
        `).join("")}
      </div>
    </section>
  `;
});
